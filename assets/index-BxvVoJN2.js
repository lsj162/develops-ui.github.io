var D=Object.defineProperty;var O=(o,t,e)=>t in o?D(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var s=(o,t,e)=>O(o,typeof t!="symbol"?t+"":t,e);import{r as h,j as n}from"./index-BMs-38SV.js";let j=class{constructor(t){s(this,"defaultOptions");s(this,"options");s(this,"style");s(this,"watermarkDom");s(this,"mutationObserver");s(this,"container");s(this,"watermarkContent");s(this,"watermarkTag");s(this,"shadowRoot");s(this,"update",(t={})=>{this.options=Object.assign({},this.options,t),this.render()});s(this,"show",()=>{this.watermarkDom&&(this.style.display="block",this.watermarkDom.setAttribute("style",this.getStyleStr(this.style)))});s(this,"hide",()=>{this.watermarkDom&&(this.style.display="none",this.watermarkDom.setAttribute("style",this.getStyleStr(this.style)))});s(this,"destroy",()=>{this.watermarkDom&&this.watermarkDom.remove(),this.destroyMutationObserver()});this.defaultOptions={container:null,text:"",image:"",gapX:100,gapY:100,offsetLeft:0,offsetTop:0,width:120,height:64,opacity:.15,rotate:-22,fontSize:16,fontColor:"#000",textAlign:"center",textBaseline:"middle",monitor:!0,zIndex:9999},this.options=Object.assign({},this.defaultOptions,t),this.style={position:"absolute",left:0,top:0,right:0,bottom:0,pointerEvents:"none",overflow:"hidden",backgroundColor:"transparent",backgroundRepeat:"repeat"},this.style.zIndex=this.options.zIndex,this.render()}DrawPattern(){const t=document.createElement("canvas"),e=t.getContext("2d"),i=this.options.text,a=this.options.image,c=this.options.gapX,l=this.options.gapY,d=this.options.width,p=this.options.height,f=this.options.fontSize,y=this.options.textAlign,k=this.options.textBaseline,g=Number(c)+Number(d),b=Number(l)+Number(p),x=Number(this.options.offsetLeft)||Number(c)/2,v=Number(this.options.offsetTop)||Number(l)/2;return t.setAttribute("width",`${g}px`),t.setAttribute("height",`${b}px`),new Promise(w=>{if(e){if(e.translate(x,v),e.rotate(Math.PI/180*Number(this.options.rotate)),e.globalAlpha=this.options.opacity,i){e.font=`${f}px normal`,e.fillStyle=this.options.fontColor,e.textAlign=y,e.textBaseline=k;const r=Array.isArray(i)?i:[i],C=f+5;let m=(p-(f*r.length+(r.length-1)*5))/2;m=m<0?0:m;for(let u=0;u<r.length;u++)e.fillText(r[u]||"",d/2,m+C*u);return w({url:e.canvas.toDataURL(),width:g,height:b})}if(a){const r=new Image;r.crossOrigin="anonymous",r.referrerPolicy="no-referrer",r.src=a,r.onload=()=>(e.drawImage(r,0,0,d,p),w({url:e.canvas.toDataURL(),width:g,height:b}));return}}})}getContainer(){let t;if(typeof this.options.container=="string"){if(t=document.getElementById(this.options.container),!t)throw new Error("水印挂载节点未找到，请检查是否存在")}else t=this.options.container!=null?this.options.container:document.body;return t.setAttribute("style","position: relative"),t}getStyleStr(t){let e="";return Object.keys(t).forEach(i=>{const a=i.replace(/([A-Z])/g,"-$1").toLowerCase();e+=`${a}:${t[i]};`}),e}destroyMutationObserver(){this.mutationObserver&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.mutationObserver=null)}async WatermarkDom(){this.watermarkDom||(this.watermarkDom=document.createElement("div"));const e=(await this.DrawPattern()).url;return this.style.backgroundImage=`url(${e})`,this.style.backgroundRepeat="repeat, repeat",this.watermarkDom.setAttribute("style",this.getStyleStr(this.style)),this.watermarkDom}getContent(){const t=document.createElement("div");return t.setAttribute("style",this.getStyleStr({pointerEvents:"none"})),t.setAttribute("time",new Date().getTime()),t}async render(){this.destroyMutationObserver();const t=await this.WatermarkDom();if(this.container=this.getContainer(),this.watermarkContent||(this.watermarkContent=this.getContent(),this.container.append(this.watermarkContent)),this.options.container&&typeof this.watermarkContent.attachShadow=="function"?this.shadowRoot||(this.shadowRoot=this.watermarkContent.attachShadow({mode:"open"})):this.shadowRoot=this.watermarkContent,this.shadowRoot.append(t),MutationObserver&&this.options.monitor){var e={childList:!0,subtree:!0,attributeFilter:["style","class"]};this.mutationObserver=new MutationObserver(()=>{this.destroy(),this.render()}),this.mutationObserver.observe(this.container,e),this.shadowRoot&&this.mutationObserver.observe(this.shadowRoot,e)}}};function A(o,t){const{children:e,id:i}=o,[a,c]=h.useState({});return h.useImperativeHandle(t,()=>({...a})),h.useEffect(()=>{if(i){const l=new j({container:i,image:"https://ss0.baidu.com/73t1bjeh1BF3odCf/it/u=348549407,3565430726&fm=85&s=4ADA6D8706EF3EAC7FBC754E03008010"});c(l)}},[i]),n.jsx(n.Fragment,{children:e})}const S=h.forwardRef(A),R="_box_1x4kp_1",E={box:R};function B(){const o=h.useRef(null);function t(){o.current.show()}function e(){o.current.hide()}function i(){o.current.destroy()}function a(){o.current.update({container:"watermark",text:["测试水印1","测试水印2"]})}return n.jsxs(n.Fragment,{children:[n.jsx("h1",{children:"水印 "}),n.jsx("h3",{children:"演示"}),n.jsx("button",{onClick:t,children:"显示"}),n.jsx("button",{onClick:e,children:"隐藏"}),n.jsx("button",{onClick:i,children:"销毁"}),n.jsx("button",{onClick:a,children:"更新"}),n.jsx(S,{ref:o,id:"watermark",children:n.jsxs("div",{id:"watermark",className:E.box,children:[n.jsx("p",{children:"在本教程的前面部分，我们了解了画布网格和坐标空间。到目前为止，我们只使用默认网格并根据需要更改整个画布的大小。通过变换，可以使用更强大的方法将原点平移到不同的位置、旋转网格甚至缩放网格。"}),n.jsx("p",{children:"在我们查看转换方法之前，让我们先看一下另外两种方法，一旦您开始生成越来越复杂的图形，这两种方法是不可或缺的。"})]})})]})}export{B as default};
