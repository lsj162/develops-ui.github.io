import{j as o}from"./jsx-runtime-u17CrQMm.js";import{r as a}from"./iframe-ahbmcfaX.js";import"./preload-helper-PPVm8Dsz.js";let O=class{defaultOptions;options;style;watermarkDom;mutationObserver;container;watermarkContent;watermarkTag;shadowRoot;constructor(t){this.defaultOptions={container:null,text:"",image:"",gapX:100,gapY:100,offsetLeft:0,offsetTop:0,width:120,height:64,opacity:.15,rotate:-22,fontSize:16,fontColor:"#000",textAlign:"center",textBaseline:"middle",monitor:!0,zIndex:9999},this.options=Object.assign({},this.defaultOptions,t),this.style={position:"absolute",left:0,top:0,right:0,bottom:0,pointerEvents:"none",overflow:"hidden",backgroundColor:"transparent",backgroundRepeat:"repeat"},this.style.zIndex=this.options.zIndex,this.render()}DrawPattern(){const t=document.createElement("canvas"),e=t.getContext("2d"),s=this.options.text,i=this.options.image,h=this.options.gapX,c=this.options.gapY,u=this.options.width,p=this.options.height,f=this.options.fontSize,y=this.options.textAlign,x=this.options.textBaseline,g=Number(h)+Number(u),b=Number(c)+Number(p),v=Number(this.options.offsetLeft)||Number(h)/2,C=Number(this.options.offsetTop)||Number(c)/2;return t.setAttribute("width",`${g}px`),t.setAttribute("height",`${b}px`),new Promise(w=>{if(e){if(e.translate(v,C),e.rotate(Math.PI/180*Number(this.options.rotate)),e.globalAlpha=this.options.opacity,s){e.font=`${f}px normal`,e.fillStyle=this.options.fontColor,e.textAlign=y,e.textBaseline=x;const r=Array.isArray(s)?s:[s],D=f+5;let l=(p-(f*r.length+(r.length-1)*5))/2;l=l<0?0:l;for(let m=0;m<r.length;m++)e.fillText(r[m]||"",u/2,l+D*m);return w({url:e.canvas.toDataURL(),width:g,height:b})}if(i){const r=new Image;r.crossOrigin="anonymous",r.referrerPolicy="no-referrer",r.src=i,r.onload=()=>(e.drawImage(r,0,0,u,p),w({url:e.canvas.toDataURL(),width:g,height:b}));return}}})}getContainer(){let t;if(typeof this.options.container=="string"){if(t=document.getElementById(this.options.container),!t)throw new Error("水印挂载节点未找到，请检查是否存在")}else t=this.options.container!=null?this.options.container:document.body;return t.setAttribute("style","position: relative"),t}getStyleStr(t){let e="";return Object.keys(t).forEach(s=>{const i=s.replace(/([A-Z])/g,"-$1").toLowerCase();e+=`${i}:${t[s]};`}),e}update=(t={})=>{this.options=Object.assign({},this.options,t),this.render()};show=()=>{this.watermarkDom&&(this.style.display="block",this.watermarkDom.setAttribute("style",this.getStyleStr(this.style)))};hide=()=>{this.watermarkDom&&(this.style.display="none",this.watermarkDom.setAttribute("style",this.getStyleStr(this.style)))};destroy=()=>{this.watermarkDom&&this.watermarkDom.remove(),this.destroyMutationObserver()};destroyMutationObserver(){this.mutationObserver&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.mutationObserver=null)}async WatermarkDom(){this.watermarkDom||(this.watermarkDom=document.createElement("div"));const e=(await this.DrawPattern()).url;return this.style.backgroundImage=`url(${e})`,this.style.backgroundRepeat="repeat, repeat",this.watermarkDom.setAttribute("style",this.getStyleStr(this.style)),this.watermarkDom}getContent(){const t=document.createElement("div");return t.setAttribute("style",this.getStyleStr({pointerEvents:"none"})),t.setAttribute("time",new Date().getTime()),t}async render(){this.destroyMutationObserver();const t=await this.WatermarkDom();if(this.container=this.getContainer(),this.watermarkContent||(this.watermarkContent=this.getContent(),this.container.append(this.watermarkContent)),this.options.container&&typeof this.watermarkContent.attachShadow=="function"?this.shadowRoot||(this.shadowRoot=this.watermarkContent.attachShadow({mode:"open"})):this.shadowRoot=this.watermarkContent,this.shadowRoot.append(t),MutationObserver&&this.options.monitor){var e={childList:!0,subtree:!0,attributeFilter:["style","class"]};this.mutationObserver=new MutationObserver(()=>{this.destroy(),this.render()}),this.mutationObserver.observe(this.container,e),this.shadowRoot&&this.mutationObserver.observe(this.shadowRoot,e)}}};function j(n,t){const{children:e,id:s}=n,[i,h]=a.useState({});return a.useImperativeHandle(t,()=>({...i})),a.useEffect(()=>{if(s){const c=new O({container:s,image:"https://ss0.baidu.com/73t1bjeh1BF3odCf/it/u=348549407,3565430726&fm=85&s=4ADA6D8706EF3EAC7FBC754E03008010"});h(c)}},[s]),o.jsx(o.Fragment,{children:e})}const A=a.forwardRef(j),S="_box_1x4kp_1",E={box:S};function k(){const n=a.useRef(null);function t(){n.current.show()}function e(){n.current.hide()}function s(){n.current.destroy()}function i(){n.current.update({container:"watermark",text:["测试水印1","测试水印2"]})}return o.jsxs(o.Fragment,{children:[o.jsx("h1",{children:"水印 "}),o.jsx("h3",{children:"演示"}),o.jsx("button",{onClick:t,children:"显示"}),o.jsx("button",{onClick:e,children:"隐藏"}),o.jsx("button",{onClick:s,children:"销毁"}),o.jsx("button",{onClick:i,children:"更新"}),o.jsx(A,{ref:n,id:"watermark",children:o.jsxs("div",{id:"watermark",className:E.box,children:[o.jsx("p",{children:"在本教程的前面部分，我们了解了画布网格和坐标空间。到目前为止，我们只使用默认网格并根据需要更改整个画布的大小。通过变换，可以使用更强大的方法将原点平移到不同的位置、旋转网格甚至缩放网格。"}),o.jsx("p",{children:"在我们查看转换方法之前，让我们先看一下另外两种方法，一旦您开始生成越来越复杂的图形，这两种方法是不可或缺的。"})]})})]})}k.__docgenInfo={description:"",methods:[],displayName:"Page"};const P={component:k},d={args:{backgroundColor:"#000000",label:"label"}};d.parameters={...d.parameters,docs:{...d.parameters?.docs,source:{originalSource:`{
  args: {
    backgroundColor: "#000000",
    label: "label"
  }
}`,...d.parameters?.docs?.source}}};const B=["Default"];export{d as Default,B as __namedExportsOrder,P as default};
